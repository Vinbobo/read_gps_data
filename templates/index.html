<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>D·ªØ li·ªáu ch·∫•m c√¥ng</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f6f9; padding: 20px; }
    h2 { text-align: center; }
    .toolbar { display: flex; justify-content: space-between; margin-bottom: 15px; flex-wrap: wrap; }
    .search-box { flex: 1; min-width: 200px; margin-bottom: 8px; }
    .filter-box { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    input, select, button { padding: 6px 10px; font-size: 14px; border-radius: 5px; border: 1px solid #ccc; }
    button { cursor: pointer; background: #007bff; color: #fff; border: none; }
    button:hover { background: #0056b3; }
    table { width: 100%; border-collapse: collapse; background: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
    th { background: #007bff; color: #fff; cursor: pointer; }
    tr:hover { background: #f1f1f1; }
  </style>
</head>
<body>
  <h2>üìå D·ªØ li·ªáu ch·∫•m c√¥ng GPS</h2>

  <div class="toolbar">
    <!-- √î t√¨m ki·∫øm -->
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="üîç T√¨m ki·∫øm theo t√™n ho·∫∑c m√£ NV..." onkeyup="searchTable()">
    </div>

    <!-- B·ªô l·ªçc -->
    <div class="filter-box">
      <label>T·ª´:</label>
      <input type="date" id="startDate">
      <label>ƒê·∫øn:</label>
      <input type="date" id="endDate">

      <select id="timeFilter" onchange="reloadData()">
        <option value="all">T·∫•t c·∫£</option>
        <option value="week">Tu·∫ßn n√†y</option>
        <option value="month">Th√°ng n√†y</option>
        <option value="year">NƒÉm nay</option>
      </select>

      <button onclick="reloadData()">üîÑ L√†m m·ªõi</button>
      <button onclick="exportToExcel()">üì• Xu·∫•t Excel</button>
    </div>
  </div>

  <!-- B·∫£ng d·ªØ li·ªáu -->
  <table id="attendanceTable">
    <thead>
      <tr>
        <th>M√£ NV</th>
        <th>T√™n nh√¢n vi√™n</th>
        <th>ƒê·ªãa ch·ªâ</th>
        <th>Th·ªùi gian Check-in</th>
        <th>Tr·∫°ng th√°i</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let tableData = [];

    function renderTable(data) {
      const tbody = document.querySelector('#attendanceTable tbody');
      tbody.innerHTML = '';
      data.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${row.EmployeeId || ''}</td>
          <td>${row.EmployeeName || ''}</td>
          <td>${row.Address || ''}</td>
          <td>${row.CheckinTime || ''}</td>
          <td>${row.Status || ''}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function reloadData() {
      const filter = document.getElementById('timeFilter').value;
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;

      let url = `/api/attendances?filter=${filter}`;
      if (startDate && endDate) {
        url += `&startDate=${startDate}&endDate=${endDate}`;
      }

      fetch(url)
        .then(response => response.json())
        .then(data => {
          tableData = data;
          renderTable(tableData);
        })
        .catch(error => console.error('Error:', error));
    }

    function exportToExcel() {
      const filter = document.getElementById('timeFilter').value;
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;

      let url = `/api/export-excel?filter=${filter}`;
      if (startDate && endDate) {
        url += `&startDate=${startDate}&endDate=${endDate}`;
      }

      // üëâ m·ªü link download ƒë·ªÉ √©p Save As dialog
      window.open(url, '_blank');
    }

    function searchTable() {
      const keyword = document.getElementById('searchInput').value.toLowerCase();
      const filtered = tableData.filter(row =>
        (row.EmployeeId && row.EmployeeId.toString().toLowerCase().includes(keyword)) ||
        (row.EmployeeName && row.EmployeeName.toLowerCase().includes(keyword))
      );
      renderTable(filtered);
    }

    // T·ª± ƒë·ªông t·∫£i d·ªØ li·ªáu khi m·ªü trang
    window.onload = reloadData;
  </script>
</body>
</html>
